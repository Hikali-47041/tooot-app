Optimize performance and fix bugs
